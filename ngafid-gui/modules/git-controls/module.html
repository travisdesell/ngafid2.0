<div id="git-controls">
    <div class="row" style="margin-top:1rem">
        <button class="btn" id="git-deploy">Deploy Latest</button>
    </div>
</div>

<script>

    (function () {

        function show(text) {
            if (window.NGAFID && typeof window.NGAFID.show === 'function')
                return window.NGAFID.show(text);
            console.log(text);
        }

        async function deploy() {
            show('$ deploy latest');
            const response = await fetch('/api/deploy', { method: 'POST' });
            const json = await response.json();

            if (!json.ok)
                return show(`[error] ${json.error}`);

            show(json.out || '(done)');
            if (window.NGAFID && typeof window.NGAFID.refreshServiceStatus === 'function')
                await window.NGAFID.refreshServiceStatus();
        }

        document.getElementById('git-deploy')?.addEventListener('click', deploy);

    })();

</script>
